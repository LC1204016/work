# 交通分配计算软件
《交通规划原理》课程设计项目

这是一个用于交通网络流量分配计算和分析的软件，支持多种分配算法，并提供可视化功能。

## 功能特点

1. **多种分配算法**：
   - 全有全无分配（All-or-Nothing）
   - 增量分配（Incremental Assignment）
   - Frank-Wolfe算法（用户均衡分配）

2. **分析功能**：
   - 计算不考虑拥堵的最短路径
   - 考虑拥堵效应的交通分配
   - 单个OD对的详细分析
   - 路网总出行时间计算

3. **可视化**：
   - 路网结构可视化
   - 路段流量标注
   - 不同算法结果比较

## 文件结构

```
D:\dev\work\
├── main.py              # 主程序入口
├── datas.py             # 网络数据类
├── algorithms.py        # 交通分配算法
├── visualization.py     # 可视化模块
├── network.json         # 网络拓扑数据
├── demand.json          # 交通需求数据
├── output/              # 输出结果目录
│   ├── 全有全无分配.png
│   ├── 增量分配.png
│   ├── Frank-Wolfe算法.png
│   └── 算法比较.png
└── README.md            # 说明文档
```

## 使用方法

### 环境要求

- Python 3.12
- matplotlib库（用于可视化）

### 运行程序

```bash
# 激活虚拟环境（如果存在）
.venv\Scripts\activate

# 运行主程序
python main.py
```

### 输入数据格式

#### network.json（网络拓扑数据）
```json
{
  "nodes": {
    "name": ["A", "B", "C", "D", "E", "F", "G"],
    "x": [0, 10, 20, 10, 20, 30, 10],
    "y": [0, 0, 0, 10, 10, 10, 20]
  },
  "links": {
    "between": ["AB", "BC", "BD", "BE", "CE", "EF", "DG", "DE"],
    "capacity": [1800, 3600, 1800, 1800, 3600, 1800, 1800, 1800],
    "speedmax": [30, 60, 30, 30, 60, 30, 30, 30]
  }
}
```

#### demand.json（交通需求数据）
```json
{
  "from": ["A", "F", "A", "G", "F", "G"],
  "to": ["F", "A", "G", "A", "G", "F"],
  "amount": [2000, 1000, 500, 1000, 1000, 500]
}
```

### 输出结果

程序运行后会产生以下输出：

1. **控制台输出**：
   - 不考虑拥堵的最短路径
   - 各算法的分配结果（路段流量、总出行时间）
   - 单个OD对（A→F）的详细分析

2. **可视化图表**（保存在output/目录）：
   - 各算法的路网流量分配图
   - 算法比较图

## 算法说明

### 1. 全有全无分配（All-or-Nothing）
将每个OD对的全部交通量分配到自由流状态下的最短路径上。

### 2. 增量分配（Incremental Assignment）
将交通需求分成若干份，逐步分配到网络中，每次分配都考虑当前流量状态。

### 3. Frank-Wolfe算法
基于用户均衡原理的迭代算法，通过求解一系列线性规划问题来逼近均衡解。

## 拥堵函数

路段行程时间采用BPR函数形式：
```
t(q) = t0 × (1 + q/cap)^2
```
其中：
- t(q)：流量为q时的路段行程时间
- t0：自由流行程时间
- q：路段流量
- cap：路段通行能力

## 测试结果示例

基于给定的测试网络，三种算法的分配结果如下：

| 算法 | 总出行时间（分钟） | 特点 |
|------|------------------|------|
| 全有全无 | 1,387,777.8 | 简单快速，但可能导致某些路段过度拥堵 |
| 增量分配 | 1,372,704.5 | 考虑拥堵效应，结果更合理 |
| Frank-Wolfe | 1,226,250.6 | 理论最优，达到用户均衡状态 |

## 扩展功能

1. **自定义网络**：修改network.json和demand.json文件可以分析不同的网络结构
2. **参数调整**：可以修改算法参数（如增量分配的分割数、Frank-Wolfe的迭代次数等）
3. **结果导出**：可以扩展代码将分配结果导出为CSV或Excel格式

## 注意事项

1. 确保网络数据文件格式正确
2. 节点名称必须一致
3. 可视化需要matplotlib库支持
4. 中文显示可能需要配置字体（不影响功能）